<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Udns_trie (udns.Udns_trie)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">udns</a> &#x00BB; Udns_trie</nav><h1>Module <code>Udns_trie</code></h1><p>Prefix tree data structure for domain names</p><p>The key is a <code>Dns_name</code>, whereas the value may be any resource record. The representation is a tree, where the edges are domain name labels, and the nodes carry the <a href="../Udns_packet/index.html#type-rdata"><span>resources</span></a>, indexed by resource typ. Some special treatment is applied for zones, which must have a start of authority entry and a set of name servers. End of authority, also known as delegation, is supported. Aliases (canonical names, CNAME records) are also supported.</p><p>The data structure tries to preserve invariants recommended by the domain name system, such as that for any name there may either be an alias or any other record, there must be a SOA record, and multiple NS records for an authoritative zone, a resource type must have entries of the given type (no NS record for A type, the ttl for all resource records of a rrset is the same.</p><nav class="toc"><ul><li><a href="#abstract-trie-type">Abstract trie type</a></li><li><a href="#operations-to-modify-the-trie">Operations to modify the trie</a></li><li><a href="#checking-invariants">Checking invariants</a></li><li><a href="#lookup">Lookup</a></li></ul></nav></header><section><header><h2 id="abstract-trie-type"><a href="#abstract-trie-type" class="anchor"></a>Abstract trie type</h2></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type </span>t</code></dt><dd><p>The type of the trie.</p></dd></dl><dl><dt class="spec value" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span class="keyword">val </span>pp : <a href="index.html#type-t">t</a> Fmt.t</code></dt><dd><p><code>pp ppf t</code> pretty prints <code>t</code> to <code>ppf</code>.</p></dd></dl><dl><dt class="spec value" id="val-empty"><a href="#val-empty" class="anchor"></a><code><span class="keyword">val </span>empty : <a href="index.html#type-t">t</a></code></dt><dd><p><code>empty</code> is the empty trie.</p></dd></dl><dl><dt class="spec value" id="val-equal"><a href="#val-equal" class="anchor"></a><code><span class="keyword">val </span>equal : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></dt></dl></section><section><header><h2 id="operations-to-modify-the-trie"><a href="#operations-to-modify-the-trie" class="anchor"></a>Operations to modify the trie</h2></header><dl><dt class="spec value" id="val-insert_map"><a href="#val-insert_map" class="anchor"></a><code><span class="keyword">val </span>insert_map : <a href="../Udns_map/index.html">Udns_map</a>.t Domain_name.Map.t <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>insert_map m t</code> inserts all elements of the domain name map <code>m</code> into <code>t</code>.</p></dd></dl><dl><dt class="spec value" id="val-insert"><a href="#val-insert" class="anchor"></a><code><span class="keyword">val </span>insert : Domain_name.t <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../Udns_map/index.html">Udns_map</a>.key <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>insert n k v t</code> insert <code>k, v</code> under <code>n</code> in <code>t</code>. Existing entries are replaced.</p></dd></dl><dl><dt class="spec value" id="val-insertb"><a href="#val-insertb" class="anchor"></a><code><span class="keyword">val </span>insertb : Domain_name.t <span>&#45;&gt;</span> <a href="../Udns_map/index.html">Udns_map</a>.b <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>insertb k b t</code> insert <code>b</code> under <code>k</code> in <code>t</code>. The type is already included in <code>b</code>. Existing entries are replaced.</p></dd></dl><dl><dt class="spec value" id="val-remove"><a href="#val-remove" class="anchor"></a><code><span class="keyword">val </span>remove : Domain_name.t <span>&#45;&gt;</span> <a href="../Udns_enum/index.html#type-rr_typ">Udns_enum.rr_typ</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>remove k ty t</code> removes <code>k, ty</code> from <code>t</code>. If <code>ty</code> is <a href="../Udns_enum/index.html#type-rr_typ.ANY"><code>Udns_enum.rr_typ.ANY</code></a>, all entries of <code>k</code> are removed. Beware, this may lead to a <code>t</code> where the initially mentioned invariants are violated.</p></dd></dl><dl><dt class="spec value" id="val-remove_zone"><a href="#val-remove_zone" class="anchor"></a><code><span class="keyword">val </span>remove_zone : Domain_name.t <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>remove_zone name t</code> remove the zone <code>name</code> from <code>t</code>, retaining subzones (entries with <code>Soa</code> records). This removes as well any delegations.</p></dd></dl></section><section><header><h2 id="checking-invariants"><a href="#checking-invariants" class="anchor"></a>Checking invariants</h2></header><dl><dt class="spec type" id="type-err"><a href="#type-err" class="anchor"></a><code><span class="keyword">type </span>err</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-err.Missing_soa" class="anchored"><td class="def constructor"><a href="#type-err.Missing_soa" class="anchor"></a><code><span class="keyword">| </span></code><code>`Missing_soa<span class="keyword"> of </span>Domain_name.t</code></td></tr><tr id="type-err.Cname_other" class="anchored"><td class="def constructor"><a href="#type-err.Cname_other" class="anchor"></a><code><span class="keyword">| </span></code><code>`Cname_other<span class="keyword"> of </span>Domain_name.t</code></td></tr><tr id="type-err.Any_not_allowed" class="anchored"><td class="def constructor"><a href="#type-err.Any_not_allowed" class="anchor"></a><code><span class="keyword">| </span></code><code>`Any_not_allowed<span class="keyword"> of </span>Domain_name.t</code></td></tr><tr id="type-err.Bad_ttl" class="anchored"><td class="def constructor"><a href="#type-err.Bad_ttl" class="anchor"></a><code><span class="keyword">| </span></code><code>`Bad_ttl<span class="keyword"> of </span>Domain_name.t<span class="keyword"> * </span><a href="../Udns_map/index.html">Udns_map</a>.b</code></td></tr><tr id="type-err.Empty" class="anchored"><td class="def constructor"><a href="#type-err.Empty" class="anchor"></a><code><span class="keyword">| </span></code><code>`Empty<span class="keyword"> of </span>Domain_name.t<span class="keyword"> * </span><a href="../Udns_enum/index.html#type-rr_typ">Udns_enum.rr_typ</a></code></td></tr><tr id="type-err.Missing_address" class="anchored"><td class="def constructor"><a href="#type-err.Missing_address" class="anchor"></a><code><span class="keyword">| </span></code><code>`Missing_address<span class="keyword"> of </span>Domain_name.t</code></td></tr><tr id="type-err.Soa_not_ns" class="anchored"><td class="def constructor"><a href="#type-err.Soa_not_ns" class="anchor"></a><code><span class="keyword">| </span></code><code>`Soa_not_ns<span class="keyword"> of </span>Domain_name.t</code></td></tr></table><code> ]</code></dt></dl><dl><dt class="spec value" id="val-pp_err"><a href="#val-pp_err" class="anchor"></a><code><span class="keyword">val </span>pp_err : <a href="index.html#type-err">err</a> Fmt.t</code></dt><dd><p><code>pp_err ppf err</code> pretty prints the error <code>err</code>.</p></dd></dl><dl><dt class="spec value" id="val-check"><a href="#val-check" class="anchor"></a><code><span class="keyword">val </span>check : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (unit, <a href="index.html#type-err">err</a>) Stdlib.result</code></dt><dd><p><code>check t</code> checks all invariants.</p></dd></dl></section><section><header><h2 id="lookup"><a href="#lookup" class="anchor"></a>Lookup</h2></header><dl><dt class="spec value" id="val-pp_e"><a href="#val-pp_e" class="anchor"></a><code><span class="keyword">val </span>pp_e : [&lt; `Delegation of Domain_name.t<span class="keyword"> * </span>(int32<span class="keyword"> * </span>Domain_name.Set.t)<span class="keyword"> | </span>`EmptyNonTerminal of Domain_name.t<span class="keyword"> * </span>int32<span class="keyword"> * </span><a href="../Udns_packet/index.html#type-soa">Udns_packet.soa</a><span class="keyword"> | </span>`NotAuthoritative<span class="keyword"> | </span>`NotFound of Domain_name.t<span class="keyword"> * </span>int32<span class="keyword"> * </span><a href="../Udns_packet/index.html#type-soa">Udns_packet.soa</a> ] Fmt.t</code></dt><dt class="spec value" id="val-lookupb"><a href="#val-lookupb" class="anchor"></a><code><span class="keyword">val </span>lookupb : Domain_name.t <span>&#45;&gt;</span> <a href="../Udns_enum/index.html#type-rr_typ">Udns_enum.rr_typ</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<a href="../Udns_map/index.html">Udns_map</a>.b<span class="keyword"> * </span>(Domain_name.t<span class="keyword"> * </span>int32<span class="keyword"> * </span>Domain_name.Set.t), [&gt; `Delegation of Domain_name.t<span class="keyword"> * </span>(int32<span class="keyword"> * </span>Domain_name.Set.t)<span class="keyword"> | </span>`EmptyNonTerminal of Domain_name.t<span class="keyword"> * </span>int32<span class="keyword"> * </span><a href="../Udns_packet/index.html#type-soa">Udns_packet.soa</a><span class="keyword"> | </span>`NotAuthoritative<span class="keyword"> | </span>`NotFound of Domain_name.t<span class="keyword"> * </span>int32<span class="keyword"> * </span><a href="../Udns_packet/index.html#type-soa">Udns_packet.soa</a> ]) Stdlib.result</code></dt><dd><p><code>lookupb k ty t</code> finds <code>k, ty</code> in <code>t</code>, which may lead to an error. The authority information is returned as well.</p></dd></dl><dl><dt class="spec value" id="val-lookup"><a href="#val-lookup" class="anchor"></a><code><span class="keyword">val </span>lookup : Domain_name.t <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../Udns_map/index.html">Udns_map</a>.key <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, [&gt; `Delegation of Domain_name.t<span class="keyword"> * </span>(int32<span class="keyword"> * </span>Domain_name.Set.t)<span class="keyword"> | </span>`EmptyNonTerminal of Domain_name.t<span class="keyword"> * </span>int32<span class="keyword"> * </span><a href="../Udns_packet/index.html#type-soa">Udns_packet.soa</a><span class="keyword"> | </span>`NotAuthoritative<span class="keyword"> | </span>`NotFound of Domain_name.t<span class="keyword"> * </span>int32<span class="keyword"> * </span><a href="../Udns_packet/index.html#type-soa">Udns_packet.soa</a> ]) Stdlib.result</code></dt><dd><p><code>lookup k ty t</code> finds <code>k, ty</code> in <code>t</code>, which may lead to an error.</p></dd></dl><dl><dt class="spec value" id="val-lookup_ignore"><a href="#val-lookup_ignore" class="anchor"></a><code><span class="keyword">val </span>lookup_ignore : Domain_name.t <span>&#45;&gt;</span> <a href="../Udns_enum/index.html#type-rr_typ">Udns_enum.rr_typ</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<a href="../Udns_map/index.html">Udns_map</a>.b, unit) Stdlib.result</code></dt><dd><p><code>lookup_ignore k ty t</code> finds a <code>k, ty</code> in <code>t</code>, which may lead to an error. It ignores potential DNS invariants, e.g. that there is no surrounding zone.</p></dd></dl><dl><dt class="spec value" id="val-entries"><a href="#val-entries" class="anchor"></a><code><span class="keyword">val </span>entries : Domain_name.t <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<a href="../Udns_packet/index.html#type-rr">Udns_packet.rr</a><span class="keyword"> * </span><a href="../Udns_packet/index.html#type-rr">Udns_packet.rr</a> list, [&gt; `Delegation of Domain_name.t<span class="keyword"> * </span>(int32<span class="keyword"> * </span>Domain_name.Set.t)<span class="keyword"> | </span>`NotAuthoritative<span class="keyword"> | </span>`NotFound of Domain_name.t<span class="keyword"> * </span>int32<span class="keyword"> * </span><a href="../Udns_packet/index.html#type-soa">Udns_packet.soa</a> ]) Stdlib.result</code></dt><dd><p><code>entries name t</code> returns either the SOA and all entries for the requested <code>name</code>, or an error.</p></dd></dl><dl><dt class="spec value" id="val-fold"><a href="#val-fold" class="anchor"></a><code><span class="keyword">val </span>fold : Domain_name.t <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (Domain_name.t <span>&#45;&gt;</span> <a href="../Udns_map/index.html">Udns_map</a>.b <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, [&gt; `Delegation of Domain_name.t<span class="keyword"> * </span>(int32<span class="keyword"> * </span>Domain_name.Set.t)<span class="keyword"> | </span>`NotAuthoritative<span class="keyword"> | </span>`NotFound of Domain_name.t<span class="keyword"> * </span>int32<span class="keyword"> * </span><a href="../Udns_packet/index.html#type-soa">Udns_packet.soa</a> ]) Stdlib.result</code></dt><dt class="spec value" id="val-folde"><a href="#val-folde" class="anchor"></a><code><span class="keyword">val </span>folde : Domain_name.t <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../Udns_map/index.html">Udns_map</a>.key <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (Domain_name.t <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> (<span class="type-var">'b</span>, [&gt; `Delegation of Domain_name.t<span class="keyword"> * </span>(int32<span class="keyword"> * </span>Domain_name.Set.t)<span class="keyword"> | </span>`NotAuthoritative<span class="keyword"> | </span>`NotFound of Domain_name.t<span class="keyword"> * </span>int32<span class="keyword"> * </span><a href="../Udns_packet/index.html#type-soa">Udns_packet.soa</a> ]) Stdlib.result</code></dt><dd><p><code>folde name key t f acc</code> calls <code>f</code> with <code>dname value acc</code> element in <code>t</code> where <code>dname</code> has <code>name</code> as prefix, or an error.</p></dd></dl></section></div></body></html>