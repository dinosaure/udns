<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Udns_server (udns-server.Udns_server)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">udns-server</a> &#x00BB; Udns_server</nav><h1>Module <code>Udns_server</code></h1><p>DNS Server implementation</p></header><dl><dt class="spec module" id="module-Authentication"><a href="#module-Authentication" class="anchor"></a><code><span class="keyword">module</span> <a href="Authentication/index.html">Authentication</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Authentication, stored in a Dns_trie with privileges to operations embedded in the name.</p></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code><code> = <span class="keyword">private</span> </code><code>{</code><table class="record"><tr id="type-t.data" class="anchored"><td class="def field"><a href="#type-t.data" class="anchor"></a><code>data : <a href="../Udns_trie/index.html#type-t">Udns_trie.t</a>;</code></td></tr><tr id="type-t.auth" class="anchored"><td class="def field"><a href="#type-t.auth" class="anchor"></a><code>auth : <a href="Authentication/index.html#type-t">Authentication.t</a>;</code></td></tr><tr id="type-t.rng" class="anchored"><td class="def field"><a href="#type-t.rng" class="anchor"></a><code>rng : int <span>&#45;&gt;</span> Cstruct.t;</code></td></tr><tr id="type-t.tsig_verify" class="anchored"><td class="def field"><a href="#type-t.tsig_verify" class="anchor"></a><code>tsig_verify : <a href="../../udns/Udns/Tsig_op/index.html#type-verify">Udns.Tsig_op.verify</a>;</code></td></tr><tr id="type-t.tsig_sign" class="anchored"><td class="def field"><a href="#type-t.tsig_sign" class="anchor"></a><code>tsig_sign : <a href="../../udns/Udns/Tsig_op/index.html#type-sign">Udns.Tsig_op.sign</a>;</code></td></tr></table><code>}</code></dt><dd><p>The state of a DNS server.</p></dd></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : <a href="../Udns_trie/index.html#type-t">Udns_trie.t</a> <span>&#45;&gt;</span> <a href="Authentication/index.html#type-t">Authentication.t</a> <span>&#45;&gt;</span> (int <span>&#45;&gt;</span> Cstruct.t) <span>&#45;&gt;</span> <a href="../../udns/Udns/Tsig_op/index.html#type-verify">Udns.Tsig_op.verify</a> <span>&#45;&gt;</span> <a href="../../udns/Udns/Tsig_op/index.html#type-sign">Udns.Tsig_op.sign</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>create trie auth rng verify sign</code> creates a state record.</p></dd></dl><dl><dt class="spec value" id="val-text"><a href="#val-text" class="anchor"></a><code><span class="keyword">val</span> text : Domain_name.t <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (string, string) Stdlib.result</code></dt><dd><p><code>text name t</code> results in a string representation (zonefile) of the server.</p></dd></dl><dl><dt class="spec value" id="val-handle_question"><a href="#val-handle_question" class="anchor"></a><code><span class="keyword">val</span> handle_question : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../udns/Udns/index.html#type-proto">Udns.proto</a> <span>&#45;&gt;</span> Domain_name.t option <span>&#45;&gt;</span> <a href="../../udns/Udns/Packet/Header/index.html#type-t">Udns.Packet.Header.t</a> <span>&#45;&gt;</span> <a href="../../udns/Udns/Packet/Question/index.html#type-t">Udns.Packet.Question.t</a> <span>&#45;&gt;</span> (<a href="../../udns/Udns/Packet/Header/index.html#type-t">Udns.Packet.Header.t</a> * <a href="../../udns/Udns/Packet/index.html#type-t">Udns.Packet.t</a> * <a href="../../udns/Udns/Name_rr_map/index.html#type-t">Udns.Name_rr_map.t</a> option, <a href="../../udns/Udns_enum/index.html#type-rcode">Udns_enum.rcode</a>) Stdlib.result</code></dt><dd><p><code>handle_question t proto key_name header query</code> handles the DNS query, respecting the current state: a whitelist of record types are looked up: A | NS | CNAME | SOA | PTR | MX | TXT | AAAA | SRV | ANY | CAA | SSHFP | TLSA | DNSKEY. Zone transfer need to be authorised. If a `Key-management key was used for signing, instead of the data trie the key trie is used for lookups.</p></dd></dl><dl><dt class="spec value" id="val-notify"><a href="#val-notify" class="anchor"></a><code><span class="keyword">val</span> notify : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (Domain_name.t * Ipaddr.V4.t * int) list <span>&#45;&gt;</span> int64 <span>&#45;&gt;</span> Domain_name.t <span>&#45;&gt;</span> <a href="../../udns/Udns/Soa/index.html#type-t">Udns.Soa.t</a> <span>&#45;&gt;</span> (int64 * int * Ipaddr.V4.t * int * (<a href="../../udns/Udns/Packet/Header/index.html#type-t">Udns.Packet.Header.t</a> * <a href="../../udns/Udns/Packet/Question/index.html#type-t">Udns.Packet.Question.t</a> * <a href="../../udns/Udns/Packet/index.html#type-t">Udns.Packet.t</a>)) list</code></dt><dd><p><code>notify t active_conns now zone soa</code> creates notifications for <code>zone</code>: all secondaries with glue in the server state for <code>zone</code>, all matching <code>active_conns</code> of the <code>zone</code>, and all secondaries where a key is in the server state with IP addresses in their names.</p></dd></dl><dl><dt class="spec value" id="val-handle_tsig"><a href="#val-handle_tsig" class="anchor"></a><code><span class="keyword">val</span> handle_tsig : ?&#8288;mac:Cstruct.t <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> Ptime.t <span>&#45;&gt;</span> <a href="../../udns/Udns/Packet/Header/index.html#type-t">Udns.Packet.Header.t</a> <span>&#45;&gt;</span> <a href="../../udns/Udns/Packet/Question/index.html#type-t">Udns.Packet.Question.t</a> <span>&#45;&gt;</span> (Domain_name.t * <a href="../../udns/Udns/Tsig/index.html#type-t">Udns.Tsig.t</a> * int) option <span>&#45;&gt;</span> Cstruct.t <span>&#45;&gt;</span> ((Domain_name.t * <a href="../../udns/Udns/Tsig/index.html#type-t">Udns.Tsig.t</a> * Cstruct.t * <a href="../../udns/Udns/Dnskey/index.html#type-t">Udns.Dnskey.t</a>) option, Cstruct.t option) Stdlib.result</code></dt><dd><p><code>handle_tsig ~mac t now hdr v tsig offset buffer</code> verifies the tsig signature if present, returning the keyname, tsig, mac, and used key.</p></dd></dl><div class="spec module" id="module-Primary"><a href="#module-Primary" class="anchor"></a><code><span class="keyword">module</span> <a href="Primary/index.html">Primary</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Secondary"><a href="#module-Secondary" class="anchor"></a><code><span class="keyword">module</span> <a href="Secondary/index.html">Secondary</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></div></body></html>